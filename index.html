<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Subur Motor Tapos - Daftar Harga Ban Motor Zeneos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              zeneos: {
                red: "#e30613",
                dark: "#1a1a1a",
                gray: "#f5f5f5",
              },
            },
            boxShadow: {
              card: "0 2px 10px rgba(0, 0, 0, 0.05)",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
      }

      .animate-fade-in {
        animation: fadeIn 0.4s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .hover-scale {
        transition: all 0.2s ease;
      }

      .hover-scale:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .tire-pattern {
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
      }

      .table-container {
        overflow-x: auto;
        scrollbar-width: thin;
      }

      .table-container::-webkit-scrollbar {
        height: 6px;
      }

      .table-container::-webkit-scrollbar-thumb {
        background-color: #cbd5e0;
        border-radius: 20px;
      }

      .table-container::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 20px;
      }

      .progress {
        position: fixed;
        top: 0;
        left: 0;
        height: 3px;
        width: 0;
        background-color: #e30613;
        z-index: 50;
        transition: width 0.3s ease;
      }

      /* Grid layout for the brand sections */
      .grid-layout {
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 1rem;
      }

      @media (min-width: 768px) {
        .grid-layout {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media print {
        /* Basic print settings */
        @page {
          size: A4;
          margin: 10mm;
        }

        /* Force each page to contain exactly 2 sections */
        .grid-layout {
          display: grid;
          grid-template-columns: repeat(2, 2fr);
          gap: 12px !important;
          margin: 0px !important;
          padding: 0 !important;
        }

        /* Clean container styling */
        .max-w-7xl {
          max-width: none !important;
          margin: 0 !important;
          padding: 0 !important;
        }

        /* Brand image sizing */
        .print-image {
          width: 8rem !important;
          height: 8rem !important;
          background-size: contain !important;
          background-position: center !important;
          background-repeat: no-repeat !important;
          margin: 0 auto !important;
        }

        /* Compact tables for print */
        .print-compact th {
          font-size: 10pt !important;
          padding: 2px 4px !important;
        }

        .print-compact td {
          font-size: 9pt !important;
          padding: 2px 4px !important;
          line-height: 1.2 !important;
        }

        /* Hide web-only content */
        .brand-header {
          display: none !important;
        }

        .tire-details {
          display: none !important;
        }

        /* Always show print layout */
        .print-layout {
          display: block !important;
        }

        /* Smaller header text to save space */
        header h1 {
          font-size: 14pt !important;
        }
      }
    </style>
  </head>

  <body class="bg-gray-50 text-black">
    <!-- Loading Progress Bar -->
    <div id="progress" class="progress"></div>

    <div
      class="max-w-7xl mx-auto bg-white shadow-card print:shadow-none min-h-screen"
    >
      <!-- Header -->
      <header class="border-b pb-6 pt-6 px-4 md:px-8 bg-white print:bg-white">
        <div
          class="flex flex-col sm:flex-row justify-between items-center gap-4"
        >
          <div class="flex items-center">
            <img
              src="./assets/logo.png"
              alt="Zeneos Logo"
              class="w-24 md:w-28 mr-4 logo"
            />
          </div>

          <div class="flex-1 text-center">
            <h1 class="text-xl md:text-2xl font-bold uppercase print:9xl">
              Subur Motor Tapos
            </h1>
            <p class="text-sm text-zeneos-red font-medium mt-1 detail">
              Daftar Harga Eceran
            </p>
          </div>

          <div class="flex flex-col items-center">
            <div class="bg-gray-100 p-2 rounded-lg">
              <img
                src="./assets/qrcode.png"
                alt="QR Code"
                class="w-16 h-16 md:w-20 md:h-20 logo"
              />
            </div>
            <p class="text-xs text-gray-600 mt-2">Scan untuk katalog digital</p>
          </div>
        </div>

        <div class="print:hidden mt-6 flex flex-col sm:flex-row gap-3">
          <div class="relative flex-1">
            <input
              type="text"
              id="searchInput"
              placeholder="Cari ukuran ban atau tipe..."
              class="w-full px-4 py-2.5 border border-gray-200 rounded-lg pl-10 focus:outline-none focus:ring-2 focus:ring-zeneos-red focus:border-transparent text-sm"
            />
            <i
              class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
            ></i>
          </div>

          <div class="flex gap-2 shrink-0 flex-wrap sm:flex-nowrap justify-end">
            <button
              id="changeTheme"
              class="px-3.5 py-2.5 border border-gray-200 text-gray-700 rounded-lg flex items-center hover:bg-gray-50 transition-colors text-sm"
              aria-label="Ubah tema"
            >
              <i class="fas fa-moon mr-2"></i> <span>Mode Gelap</span>
            </button>
            <button
              onclick="printPrice()"
              class="px-3.5 py-2.5 bg-zeneos-dark text-white rounded-lg flex items-center hover:bg-black transition-colors text-sm whitespace-nowrap"
              aria-label="Cetak daftar harga"
            >
              <i class="fas fa-print mr-2"></i> Cetak
            </button>
          </div>
        </div>

        <div class="flex justify-end mt-4 print:hidden">
          <div
            class="inline-flex rounded-lg border border-gray-200 overflow-hidden"
          >
            <button
              id="collapseAll"
              class="px-3 py-1.5 text-xs border-r border-gray-200 hover:bg-gray-50"
              aria-label="Ciutkan semua kategori"
            >
              <i class="fas fa-compress-alt mr-1"></i> Ciutkan
            </button>
            <button
              id="expandAll"
              class="px-3 py-1.5 text-xs hover:bg-gray-50"
              aria-label="Perluas semua kategori"
            >
              <i class="fas fa-expand-alt mr-1"></i> Perluas
            </button>
          </div>
        </div>
      </header>

      <!-- Loading indicator -->
      <div id="loadingIndicator" class="flex justify-center items-center py-20">
        <div class="flex flex-col items-center">
          <div
            class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-zeneos-red mb-3"
          ></div>
          <p class="text-gray-500 text-sm">Memuat data harga...</p>
        </div>
      </div>

      <!-- Main content -->
      <main id="content" class="p-4 md:p-8 hidden animate-fade-in">
        <div class="grid-layout">
          <!-- Content will be injected here -->
        </div>
      </main>

      <!-- No results -->
      <div id="noResults" class="hidden text-center py-16">
        <i class="fas fa-search text-5xl text-gray-300 mb-4"></i>
        <h3 class="text-gray-800 font-medium mb-1">
          Tidak ditemukan data yang sesuai
        </h3>
        <p class="text-gray-500">
          Coba gunakan kata kunci pencarian yang berbeda
        </p>
      </div>

      <!-- Footer -->
      <footer
        class="text-center border-t py-5 px-6 text-sm text-gray-500 mt-auto"
      >
        <p class="max-w-md mx-auto">
          Harga dapat berubah sewaktu-waktu tanpa pemberitahuan terlebih dahulu
        </p>
        <p class="mt-2 font-medium text-gray-600">
          Â© <span id="currentYear"></span> Subur Motor Tapos - Distributor Resmi
          Ban Zeneos
        </p>
      </footer>
    </div>

    <script>
      // Pattern images with fallbacks
      const patternImages = {
        ZN62: "./assets/zn62.jpg",
        MILANO: "./assets/milano.jpg",
        TURINO: "./assets/turino.jpg",
        ROADMAX: "./assets/roadmax.jpeg",
        ZN77: "./assets/zn77.jpg",
        ZN88: "./assets/zn88.jpg",
        ZN91: "./assets/zn91.jpg",
        STRATO: "./assets/strato.jpg",
        ZN61: "./assets/zn61.jpg",
        SCOOTZ: "./assets/scootz.jpg",
      };

      // Store complete data
      let allTireData = [];
      let isDataLoaded = false;

      // Get DOM elements
      const progress = document.getElementById("progress");
      const container = document.getElementById("content");
      const noResults = document.getElementById("noResults");
      const loadingIndicator = document.getElementById("loadingIndicator");
      const searchInput = document.getElementById("searchInput");
      const themeToggle = document.getElementById("changeTheme");
      const collapseAllBtn = document.getElementById("collapseAll");
      const expandAllBtn = document.getElementById("expandAll");

      // Collapse/Expand functionality
      collapseAllBtn.addEventListener("click", function () {
        document.querySelectorAll(".tire-details").forEach((el) => {
          el.classList.add("hidden");
        });
        document.querySelectorAll(".collapse-icon").forEach((el) => {
          el.classList.remove("fa-chevron-down");
          el.classList.add("fa-chevron-right");
        });
      });

      expandAllBtn.addEventListener("click", function () {
        document.querySelectorAll(".tire-details").forEach((el) => {
          el.classList.remove("hidden");
        });
        document.querySelectorAll(".collapse-icon").forEach((el) => {
          el.classList.add("fa-chevron-down");
          el.classList.remove("fa-chevron-right");
        });
      });

      // Print function
      function printPrice() {
        if (!isDataLoaded) {
          alert("Tidak ada data untuk dicetak");
          return;
        }

        // Expand all sections before printing
        document.querySelectorAll(".tire-details").forEach((el) => {
          el.classList.remove("hidden");
        });

        window.print();
      }
      // Search functionality
      searchInput.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();

        if (!allTireData.length) return;

        if (searchTerm === "") {
          renderData(allTireData);
          return;
        }

        const filtered = allTireData.filter(
          (item) =>
            item.Size.toLowerCase().includes(searchTerm) ||
            item.Brand.toLowerCase().includes(searchTerm)
        );

        renderData(filtered);
      });

      function renderData(data) {
        const gridContainer = container.querySelector(".grid-layout");
        gridContainer.innerHTML = "";

        if (data.length === 0) {
          container.classList.add("hidden");
          noResults.classList.remove("hidden");
          return;
        }

        container.classList.remove("hidden");
        noResults.classList.add("hidden");

        // Group by Brand
        const grouped = data.reduce((acc, cur) => {
          (acc[cur.Brand] = acc[cur.Brand] || []).push(cur);
          return acc;
        }, {});

        // Sort brands by quantity of data (from most to least items)
        const sortedBrands = Object.keys(grouped).sort((a, b) => {
          // Sort by number of items for each brand
          return grouped[b].length - grouped[a].length;
        });

        for (const brand of sortedBrands) {
          const items = grouped[brand];

          // Replace the existing sorting code with this improved approach
          items.sort((a, b) => {
            // Extract rim size (the number after the dash)
            const getRimSize = (size) => {
              const match = size.match(/[-]\s*(\d+)/); // Matches "- 14" or "-14"
              return match ? parseInt(match[1]) : 0;
            };

            // Extract width (first number in the size format)
            const getWidth = (size) => {
              const match = size.match(/^(\d+)/);
              return match ? parseInt(match[1]) : 0;
            };

            // Check if size has RS suffix
            const hasRS = (size) => {
              return /RS/i.test(size);
            };

            // First compare rim sizes
            const rimSizeA = getRimSize(a.Size);
            const rimSizeB = getRimSize(b.Size);

            if (rimSizeA !== rimSizeB) {
              return rimSizeA - rimSizeB; // Sort by rim size (14 before 17)
            }

            // If same rim size, check for RS suffix
            const aHasRS = hasRS(a.Size);
            const bHasRS = hasRS(b.Size);

            if (aHasRS !== bHasRS) {
              return aHasRS ? 1 : -1; // Regular sizes before RS
            }

            // If same rim size and both have or don't have RS, sort by width
            return getWidth(a.Size) - getWidth(b.Size);
          });

          const section = document.createElement("section");
          section.className =
            "bg-white border rounded-lg shadow-card hover-scale print:shadow-none print-shadow-none animate-fade-in";

          const brandImageUrl = patternImages[brand] || "placeholder.jpg";

          // Group items by performance category
          const regularItems = [];
          const highPerformanceItems = [];

          items.forEach((item) => {
            if (item["Performance Category"] === "High Performance") {
              highPerformanceItems.push(item);
            } else {
              regularItems.push(item);
            }
          });
          // Generate table HTML for a category
          const generateTableHTML = (items) => {
            return `
              <table class="w-full border-collapse text-xs md:text-sm print-compact">
                <thead>
                  <tr>
                    <th class="border px-3 py-2 bg-zeneos-dark text-white text-left">UKURAN</th>
                    <th class="border px-3 py-2 bg-zeneos-dark text-white text-right">HARGA</th>
                  </tr>
                </thead>
                <tbody>
                  ${items
                    .map(
                      (item) => `
                    <tr class="hover:bg-gray-50">
                      <td class="border px-3 py-2 font-medium">${item.Size}</td>
                      <td class="border px-3 py-2 text-right">${item[
                        "Price (IDR)"
                      ].toLocaleString("id-ID")}</td>
                    </tr>`
                    )
                    .join("")}
                </tbody>
              </table>
            `;
          };

          // Standard web view layout
          section.innerHTML = `
            <div class="p-4 cursor-pointer brand-header flex items-center justify-between transition-colors hover:bg-gray-50" data-brand="${brand}">
              <div class="flex items-center gap-3">
                <div class="bg-gray-100 w-16 h-16 rounded-lg p-2 flex-shrink-0 tire-pattern"
                     style="background-image: url('${brandImageUrl}')"></div>
                <div>
                  <h2 class="text-base md:text-lg font-semibold">${brand}</h2>
                  <div class="flex items-center gap-2 mt-1">
                    <span class="bg-zeneos-gray text-xs font-medium px-2 py-0.5 rounded-full">${
                      items.length
                    } ukuran</span>
                  </div>
                </div>
              </div>
              <i class="fas fa-chevron-down text-gray-400 collapse-icon transition-transform"></i>
            </div>

            <div class="tire-details">
              <div class="table-container">
                ${
                  regularItems.length > 0 ? generateTableHTML(regularItems) : ""
                }
              </div>
            </div>

            <!-- Special print layout - IMPROVED -->
            <div class="print-layout hidden print:block">
              <div class="print-image-container">
                <div class="print-image" style="background-image: url('${brandImageUrl}')"></div>
              </div>
              <div class="print-table-container">
                ${
                  regularItems.length > 0
                    ? `
                   ${generateTableHTML(regularItems)}`
                    : ""
                }

                ${
                  highPerformanceItems.length > 0
                    ? `<div class="performance-header">High Performance</div>
                   ${generateTableHTML(highPerformanceItems)}`
                    : ""
                }
              </div>
            </div>
          `;

          gridContainer.appendChild(section);
        }

        // Add collapse/expand functionality to each section
        document.querySelectorAll(".brand-header").forEach((header) => {
          header.addEventListener("click", () => {
            const details = header.nextElementSibling;
            const icon = header.querySelector(".collapse-icon");

            details.classList.toggle("hidden");
            icon.classList.toggle("fa-chevron-down");
            icon.classList.toggle("fa-chevron-right");
          });
        });
      }

      // Initialize with animation
      function updateProgress(value) {
        progress.style.width = `${value}%`;
      }

      // Load data
      function loadData() {
        updateProgress(10);

        setTimeout(() => {
          updateProgress(30);

          fetch("./data.json")
            .then((response) => {
              updateProgress(50);
              return response.json();
            })
            .then((data) => {
              updateProgress(80);

              setTimeout(() => {
                allTireData = data;
                isDataLoaded = true;

                renderData(data);
                loadingIndicator.classList.add("hidden");
                container.classList.remove("hidden");

                updateProgress(100);

                setTimeout(() => {
                  progress.style.opacity = 0;
                }, 700);
              }, 300);
            })
            .catch((error) => {
              console.error("Could not load data:", error);
              loadingIndicator.classList.add("hidden");
              container.innerHTML = `
                <div class="text-center py-12">
                  <i class="fas fa-exclamation-circle text-5xl text-red-500 mb-4"></i>
                  <h3 class="text-lg font-medium mb-2">Gagal memuat data</h3>
                  <p class="text-gray-500 max-w-md mx-auto">Terjadi kesalahan saat memuat data harga. Silakan muat ulang halaman atau hubungi administrator.</p>
                </div>
              `;
              container.classList.remove("hidden");
            });
        }, 300);
      }

      // Initialize the app
      document.addEventListener("DOMContentLoaded", () => {
        loadData();
        document.getElementById("currentYear").textContent =
          new Date().getFullYear();
      });
    </script>
  </body>
</html>
